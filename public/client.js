(()=>{const query=async(e,n="")=>await(await fetch("https://snippit-backend.herokuapp.com/graphql",{headers:{"content-type":"application/json",authentication:n},body:JSON.stringify({operationName:null,variables:{},query:e}),method:"POST",mode:"cors"})).json(),login=async(e,n)=>(await query(`{validate(username:"${encodeURIComponent(e)}",password:"${encodeURIComponent(n)}")}`)).data.validate,getSnip=async(e,n)=>{const{data:t,...i}=await query(`{\n      snips(query: { name: "${encodeURIComponent(e)}" }) {\n        content\n        name\n        owner {\n          username\n        }\n      }\n    }`,n);return console.log(e,t,i),t.snips[0]},runProgram=async(name,auth)=>eval(await getSnip(name,auth)),allPrograms=async e=>(await query("{snips(query:{}) {name owner {username} }}",e)).data.snips,$f=e=>n=>e.querySelector(n),makeState=e=>{let n={},t={},i={};for(let s in e)n[s]=[],i[s]=e[s],Object.defineProperty(t,s,{get:()=>i[s],set:e=>{const t=i[s];i[s]=e,n[s].forEach(n=>n(e,t))}});return t.subscribe=((e,t)=>{n[e].push(t),t(i[e])}),t},getUpdate=async e=>Math.random()>.5?{available:!0,text:"asdf"}:{available:!1,text:null},getInstallCode=e=>`javascript:alert("${e}")`,getSnippets=async e=>allPrograms(),debounce=(e,n=500)=>{let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>e(...i),n)}},closeHandler=(e,n)=>{const t=n("#toggle-closed"),i=n("#parent");e.subscribe("closed",e=>{e?i.classList.add("closed"):i.classList.remove("closed")}),t.addEventListener("click",()=>e.closed=!e.closed),i.addEventListener("mouseleave",()=>e.closed=!0),i.addEventListener("mouseenter",()=>e.closed=!1)},searchHandler=(e,n)=>{const t=n("#search-input"),i=debounce(async()=>{e.loading=!0,e.currentResults=""===e.currentQuery?null:await getSnippets(e.currentQuery),e.loading=!1});e.subscribe("currentQuery",n=>{e.loading=!1,t.value=n,""===n?e.currentResults=null:i(n)}),t.addEventListener("input",n=>{console.log(n.target.value),e.currentQuery=n.target.value})},Result=e=>n=>{const{id:t,name:i}=n,s=document.createElement("div");$f(s);return s.innerHTML=`\n      <div class="snippet-name">${i}</div>\n  `,s.id="snippet-"+t,s.classList.add("snippet-container"),s.addEventListener("click",t=>{e.currentSnippet=n}),s},resultsHandler=(e,n)=>{const t=n("#no-search"),i=n("#no-results"),s=n("#loader"),o=n("#result-list");e.subscribe("currentQuery",e=>{t.hidden=""!==e}),e.subscribe("currentResults",e=>{i.hidden=null===e||e.length>0}),e.subscribe("loading",e=>{s.hidden=!e}),e.subscribe("currentResults",t=>{if(o.innerHTML="",null!==t){const i=t.map(Result(e,n));o.appendChild(i.reduce((e,n)=>(e.appendChild(n),e),document.createDocumentFragment()))}})},snippetHandler=(e,n)=>{const t=n("#snippet-name"),i=n("#snip-maker"),s=n("#snip-version"),o=n("#install-snip"),a=n("#snippet-description"),r=n("#back-button"),d=n("#sections-container");e.subscribe("currentSnippet",async e=>{if(null===e)d.classList.remove("snippet-focused");else{t.innerText=e.name,s.innerText="...Loading",i.innerText="...Loading",a.innerText="...Loading",d.classList.add("snippet-focused");const{desc:n,version:r,owner:l,content:c}=await getSnip(e.name);s.innerText=r,i.innerText=l.username,a.innerText=n,o.href=`javascript:${c}`}}),r.addEventListener("click",()=>{e.currentSnippet=null})},cssStr='body,html{background-color:#eee}#parent{position:fixed;left:1em;bottom:1em;background-color:#fff;border-radius:2em;overflow:hidden;min-width:20rem;min-height:25rem;width:20vw;height:50vh;max-width:20vw;max-height:50vh;transition:opacity .25s ease-in-out,max-width .25s ease-in-out,max-height .25s ease-in-out,min-width .25s ease-in-out,min-height .25s ease-in-out;display:flex;flex-direction:column}#parent.closed{max-width:2.5rem;max-height:2.5rem;min-width:2.5rem;min-height:2.5rem}#toggle-closed{position:absolute;left:.75em;bottom:.75em;width:2.5rem;height:2.5rem;border-radius:2em;border:none;outline:0;cursor:pointer;font-family:"Lucida Console",Monaco,monospace;user-select:none;box-shadow:0 4px 12px rgba(0,0,0,.12),0 2px 4px rgba(0,0,0,.24);transition:bottom .25s ease-in-out,left .25s ease-in-out}.closed #toggle-closed{left:0;bottom:0}#body{flex-grow:1;width:100%;overflow:hidden}#bottom-bar{height:1.5em;padding:1em;padding-right:2em;text-align:right}#sections-container{height:100%;width:calc(200%);display:flex;transition:transform .25s ease-in-out}#sections-container.snippet-focused{transform:translateX(-50%)}.section{min-width:50%;max-width:50%;padding:1em;box-sizing:border-box;height:100%}.top-bar{font-size:1.2em;margin-bottom:.5em;text-align:center;position:relative}.top-bar button{position:absolute;left:0;top:0;border:none;background:0 0;transform:translateY(-3px);width:2em;height:2em;cursor:pointer;outline:0}.top-bar button i{border:solid #000;border-width:0 3px 3px 0;display:inline-block;padding:3px;transform:rotate(135deg)}.panel-body{height:100%;display:flex;flex-direction:column}#search-container{z-index:2;display:flex;align-items:stretch;box-shadow:0 4px 12px rgba(0,0,0,.12),0 2px 4px rgba(0,0,0,.24);height:1.75rem;border-radius:1.75em;padding:.25em}#search-container button{font-family:"Lucida Console",Monaco,monospace;outline:0;box-shadow:0 1px 3px rgba(0,0,0,.12),0 1px 2px rgba(0,0,0,.24);min-width:1.75rem;height:1.75rem;border-radius:1.75em;border:none;transition:box-shadow .25s ease-in-out}#search-input{flex-grow:1;flex-shrink:1;min-width:0;border:none;background:0 0;box-sizing:border-box;padding:1em;outline:0}#result-container{padding:.5em 0;overflow:auto;flex-grow:1}#result-list{overflow-y:auto}.loader-image{width:3em}.snippet-container{user-select:none;padding:.5em;cursor:pointer}.snippet-container:hover{background-color:#eee}',client=e=>{const n=makeState({closed:!1,loading:!1,currentQuery:"",currentSnippet:null,currentResults:null}),t=e.attachShadow({mode:"open"});t.innerHTML=`\n    <style>${cssStr}</style><div id=parent><div id=body><div id=sections-container><section class=section id=section-search><div class=top-bar>Search for snips</div><div class=panel-body><div id=search-container><input id=search-input> <button>></button></div><div id=result-container><p id=no-search>Start typing to search<p id=no-results>No results found<p id=loader><img class=loader-image src=https://samherbert.net/svg-loaders/svg-loaders/spinning-circles.svg> Loading<div id=result-list></div></div></section><section class=section id=section-snippit><div class=top-bar><button id=back-button><i></button> Install Snippet</div><div class=panel-body><h3 id=snippet-name></h3><div class=meta-info><h6 id=snip-maker></h6><h6 id=snip-version></h6><a class=button id=install-snip>Run</a></div><p id=snippet-description></p><a href=https://example.com>See on page</a></div></section></div></div><div id=bottom-bar><button id=toggle-closed>Ã—</button> <a href=https://snippet.ml>See on snippet website</a></div></div>`;const i=$f(t);closeHandler(n,i),searchHandler(n,i),resultsHandler(n,i),snippetHandler(n,i)},d=document.createElement("div");document.body.appendChild(d),client(d)})();
